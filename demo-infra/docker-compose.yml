version: '3.8'

networks:
  management:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24
  client-net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.10.0/24
  router-switch-net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.20.0/24
  server-net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.30.0/24

services:
  frr-router1:
    build: ./frr-router
    container_name: frr-router
    hostname: frr-router
    privileged: true
    ports:
      - "7777:22"
    volumes:
      - ./test-ssh-keys/authorized_keys:/home/frruser/.ssh/authorized_keys:rw
    networks:
      client-net:
        ipv4_address: 192.168.10.2
      management:
        ipv4_address: 172.20.0.10
      router-switch-net:
        ipv4_address: 192.168.20.2

  ovs-switch1:
    build: ./ovs-switch
    container_name: ovs-switch
    hostname: ovs-switch
    privileged: true
    ports:
      - "7778:22"
    volumes:
      - ./test-ssh-keys/authorized_keys:/home/ovsuser/.ssh/authorized_keys:rw
    networks:
      management:
        ipv4_address: 172.20.0.11
      router-switch-net:
        ipv4_address: 192.168.20.3   # ‚Üê was 192.168.20.2, now changed to avoid conflict
      server-net:
        ipv4_address: 192.168.30.2

  client1:
    build: ./client
    container_name: client
    hostname: client
    privileged: true
    ports:
      - "7779:22"
    volumes:
      - ./test-ssh-keys/authorized_keys:/home/clientuser/.ssh/authorized_keys:rw
    networks:
      management:
        ipv4_address: 172.20.0.5
      client-net:
        ipv4_address: 192.168.10.10

  server1:
    build: ./server
    container_name: server
    hostname: server
    privileged: true
    ports:
      - "7780:22"
    volumes:
      - ./test-ssh-keys/authorized_keys:/home/serveruser/.ssh/authorized_keys:rw
    networks:
      management:
        ipv4_address: 172.20.0.20
      server-net:
        ipv4_address: 192.168.30.10
